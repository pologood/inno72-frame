<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.point72.alarm.center.mapper.DepartmentMapper" >
  <resultMap id="BaseResultMap" type="com.point72.alarm.center.model.Department" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jun 28 12:58:41 CST 2017.
    -->
    <id column="id" property="id" jdbcType="VARCHAR" />
    <result column="name" property="name" jdbcType="VARCHAR" />
    <result column="order_num" property="orderNum" jdbcType="INTEGER" />
    <result column="parent_id" property="parentId" jdbcType="VARCHAR" />
    <result column="create_dept_group" property="createDeptGroup" jdbcType="BIT" />
    <result column="auto_add_user" property="autoAddUser" jdbcType="BIT" />
    <result column="dept_hiding" property="deptHiding" jdbcType="BIT" />
    <result column="dept_perimits" property="deptPerimits" jdbcType="VARCHAR" />
    <result column="user_perimits" property="userPerimits" jdbcType="VARCHAR" />
    <result column="outer_dept" property="outerDept" jdbcType="BIT" />
    <result column="outer_permit_depts" property="outerPermitDepts" jdbcType="VARCHAR" />
    <result column="outer_permit_users" property="outerPermitUsers" jdbcType="VARCHAR" />
    <result column="org_dept_owner" property="orgDeptOwner" jdbcType="VARCHAR" />
    <result column="dept_manager_userid_list" property="deptManagerUseridList" jdbcType="VARCHAR" />
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jun 28 12:58:41 CST 2017.
    -->
    id, name, order_num, parent_id, create_dept_group, auto_add_user, dept_hiding, dept_perimits, 
    user_perimits, outer_dept, outer_permit_depts, outer_permit_users, org_dept_owner, 
    dept_manager_userid_list
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.String" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jun 28 12:58:41 CST 2017.
    -->
    select 
    <include refid="Base_Column_List" />
    from pmp_department
    where id = #{id,jdbcType=VARCHAR}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jun 28 12:58:41 CST 2017.
    -->
    delete from pmp_department
    where id = #{id,jdbcType=VARCHAR}
  </delete>
  <insert id="insert" parameterType="com.point72.alarm.center.model.Department" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jun 28 12:58:41 CST 2017.
    -->
    insert into pmp_department (id, name, order_num, 
      parent_id, create_dept_group, auto_add_user, 
      dept_hiding, dept_perimits, user_perimits, 
      outer_dept, outer_permit_depts, outer_permit_users, 
      org_dept_owner, dept_manager_userid_list)
    values (#{id,jdbcType=VARCHAR}, #{name,jdbcType=VARCHAR}, #{orderNum,jdbcType=INTEGER}, 
      #{parentId,jdbcType=VARCHAR}, #{createDeptGroup,jdbcType=BIT}, #{autoAddUser,jdbcType=BIT}, 
      #{deptHiding,jdbcType=BIT}, #{deptPerimits,jdbcType=VARCHAR}, #{userPerimits,jdbcType=VARCHAR}, 
      #{outerDept,jdbcType=BIT}, #{outerPermitDepts,jdbcType=VARCHAR}, #{outerPermitUsers,jdbcType=VARCHAR}, 
      #{orgDeptOwner,jdbcType=VARCHAR}, #{deptManagerUseridList,jdbcType=VARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="com.point72.alarm.center.model.Department" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jun 28 12:58:41 CST 2017.
    -->
    insert into pmp_department
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="name != null" >
        name,
      </if>
      <if test="orderNum != null" >
        order_num,
      </if>
      <if test="parentId != null" >
        parent_id,
      </if>
      <if test="createDeptGroup != null" >
        create_dept_group,
      </if>
      <if test="autoAddUser != null" >
        auto_add_user,
      </if>
      <if test="deptHiding != null" >
        dept_hiding,
      </if>
      <if test="deptPerimits != null" >
        dept_perimits,
      </if>
      <if test="userPerimits != null" >
        user_perimits,
      </if>
      <if test="outerDept != null" >
        outer_dept,
      </if>
      <if test="outerPermitDepts != null" >
        outer_permit_depts,
      </if>
      <if test="outerPermitUsers != null" >
        outer_permit_users,
      </if>
      <if test="orgDeptOwner != null" >
        org_dept_owner,
      </if>
      <if test="deptManagerUseridList != null" >
        dept_manager_userid_list,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=VARCHAR},
      </if>
      <if test="name != null" >
        #{name,jdbcType=VARCHAR},
      </if>
      <if test="orderNum != null" >
        #{orderNum,jdbcType=INTEGER},
      </if>
      <if test="parentId != null" >
        #{parentId,jdbcType=VARCHAR},
      </if>
      <if test="createDeptGroup != null" >
        #{createDeptGroup,jdbcType=BIT},
      </if>
      <if test="autoAddUser != null" >
        #{autoAddUser,jdbcType=BIT},
      </if>
      <if test="deptHiding != null" >
        #{deptHiding,jdbcType=BIT},
      </if>
      <if test="deptPerimits != null" >
        #{deptPerimits,jdbcType=VARCHAR},
      </if>
      <if test="userPerimits != null" >
        #{userPerimits,jdbcType=VARCHAR},
      </if>
      <if test="outerDept != null" >
        #{outerDept,jdbcType=BIT},
      </if>
      <if test="outerPermitDepts != null" >
        #{outerPermitDepts,jdbcType=VARCHAR},
      </if>
      <if test="outerPermitUsers != null" >
        #{outerPermitUsers,jdbcType=VARCHAR},
      </if>
      <if test="orgDeptOwner != null" >
        #{orgDeptOwner,jdbcType=VARCHAR},
      </if>
      <if test="deptManagerUseridList != null" >
        #{deptManagerUseridList,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.point72.alarm.center.model.Department" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jun 28 12:58:41 CST 2017.
    -->
    update pmp_department
    <set >
      <if test="name != null" >
        name = #{name,jdbcType=VARCHAR},
      </if>
      <if test="orderNum != null" >
        order_num = #{orderNum,jdbcType=INTEGER},
      </if>
      <if test="parentId != null" >
        parent_id = #{parentId,jdbcType=VARCHAR},
      </if>
      <if test="createDeptGroup != null" >
        create_dept_group = #{createDeptGroup,jdbcType=BIT},
      </if>
      <if test="autoAddUser != null" >
        auto_add_user = #{autoAddUser,jdbcType=BIT},
      </if>
      <if test="deptHiding != null" >
        dept_hiding = #{deptHiding,jdbcType=BIT},
      </if>
      <if test="deptPerimits != null" >
        dept_perimits = #{deptPerimits,jdbcType=VARCHAR},
      </if>
      <if test="userPerimits != null" >
        user_perimits = #{userPerimits,jdbcType=VARCHAR},
      </if>
      <if test="outerDept != null" >
        outer_dept = #{outerDept,jdbcType=BIT},
      </if>
      <if test="outerPermitDepts != null" >
        outer_permit_depts = #{outerPermitDepts,jdbcType=VARCHAR},
      </if>
      <if test="outerPermitUsers != null" >
        outer_permit_users = #{outerPermitUsers,jdbcType=VARCHAR},
      </if>
      <if test="orgDeptOwner != null" >
        org_dept_owner = #{orgDeptOwner,jdbcType=VARCHAR},
      </if>
      <if test="deptManagerUseridList != null" >
        dept_manager_userid_list = #{deptManagerUseridList,jdbcType=VARCHAR},
      </if>
    </set>
    where id = #{id,jdbcType=VARCHAR}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.point72.alarm.center.model.Department" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jun 28 12:58:41 CST 2017.
    -->
    update pmp_department
    set name = #{name,jdbcType=VARCHAR},
      order_num = #{orderNum,jdbcType=INTEGER},
      parent_id = #{parentId,jdbcType=VARCHAR},
      create_dept_group = #{createDeptGroup,jdbcType=BIT},
      auto_add_user = #{autoAddUser,jdbcType=BIT},
      dept_hiding = #{deptHiding,jdbcType=BIT},
      dept_perimits = #{deptPerimits,jdbcType=VARCHAR},
      user_perimits = #{userPerimits,jdbcType=VARCHAR},
      outer_dept = #{outerDept,jdbcType=BIT},
      outer_permit_depts = #{outerPermitDepts,jdbcType=VARCHAR},
      outer_permit_users = #{outerPermitUsers,jdbcType=VARCHAR},
      org_dept_owner = #{orgDeptOwner,jdbcType=VARCHAR},
      dept_manager_userid_list = #{deptManagerUseridList,jdbcType=VARCHAR}
    where id = #{id,jdbcType=VARCHAR}
  </update>
  
  <!-- 带子查询的VO -->
  <resultMap id="BaseResultVOMap" type="com.point72.alarm.center.model.Department" >
    <id column="id" property="id" jdbcType="VARCHAR" />
    <result column="name" property="name" jdbcType="VARCHAR" />
    <result column="order_num" property="orderNum" jdbcType="INTEGER" />
    <result column="parent_id" property="parentId" jdbcType="VARCHAR" />
    <result column="create_dept_group" property="createDeptGroup" jdbcType="BIT" />
    <result column="auto_add_user" property="autoAddUser" jdbcType="BIT" />
    <result column="dept_hiding" property="deptHiding" jdbcType="BIT" />
    <result column="dept_perimits" property="deptPerimits" jdbcType="VARCHAR" />
    <result column="user_perimits" property="userPerimits" jdbcType="VARCHAR" />
    <result column="outer_dept" property="outerDept" jdbcType="BIT" />
    <result column="outer_permit_depts" property="outerPermitDepts" jdbcType="VARCHAR" />
    <result column="outer_permit_users" property="outerPermitUsers" jdbcType="VARCHAR" />
    <result column="org_dept_owner" property="orgDeptOwner" jdbcType="VARCHAR" />
    <result column="dept_manager_userid_list" property="deptManagerUseridList" jdbcType="VARCHAR" />
    
    <collection property="children" column="id" select="selectParentById"></collection>
	<collection property="user" column="id" select="selectUserByDepartId"></collection>
  </resultMap>
  
  <resultMap id="BaseResultUserMap" type="com.point72.alarm.center.model.User" >
    <id column="id" property="id" jdbcType="VARCHAR" />
    <result column="userid" property="userid" jdbcType="VARCHAR" />
    <result column="name" property="name" jdbcType="VARCHAR" />
    <result column="tel" property="tel" jdbcType="VARCHAR" />
    <result column="work_place" property="workPlace" jdbcType="VARCHAR" />
    <result column="remark" property="remark" jdbcType="VARCHAR" />
    <result column="mobile" property="mobile" jdbcType="VARCHAR" />
    <result column="email" property="email" jdbcType="VARCHAR" />
    <result column="org_email" property="orgEmail" jdbcType="VARCHAR" />
    <result column="order_in_depts" property="orderInDepts" jdbcType="VARCHAR" />
    <result column="active" property="active" jdbcType="BIT" />
    <result column="is_admin" property="isAdmin" jdbcType="BIT" />
    <result column="is_boss" property="isBoss" jdbcType="BIT" />
    <result column="ding_id" property="dingId" jdbcType="VARCHAR" />
    <result column="unionid" property="unionid" jdbcType="VARCHAR" />
    <result column="is_leader_in_depts" property="isLeaderInDepts" jdbcType="BIT" />
    <result column="is_hide" property="isHide" jdbcType="BIT" />
    <result column="position" property="position" jdbcType="VARCHAR" />
    <result column="avatar" property="avatar" jdbcType="VARCHAR" />
    <result column="jobnumber" property="jobnumber" jdbcType="VARCHAR" />
    <result column="user_name" property="userName" jdbcType="VARCHAR" />
    <result column="persistent_code" property="persistentCode" jdbcType="VARCHAR" />
  </resultMap>
  
  <!-- 根据父id,查子节点 -->
    <select id="selectParentById" resultMap="BaseResultVOMap">
    	SELECT *
      FROM pmp_department where parent_id = #{id}
    </select> 
    
    <!-- 根据部门查用户列表 -->
    <select id="selectUserByDepartId" resultMap="BaseResultUserMap">
    	SELECT pu.* from pmp_department pd 
    	join pmp_user_dept pud on pd.id = pud.dept_id
		join pmp_user pu on pud.user_id = pu.id
		WHERE pd.id = #{id}
    </select> 
    
    <!-- 查询用户树形结构 -->
    <select id="findTree" resultMap="BaseResultVOMap" parameterType="java.lang.String">
    	select * from pmp_department where parent_id = 1
    </select>
    
</mapper>